<html>
<head>
  <script src="../lib/OpenLayers.js"></script>
  <script type="text/javascript">

    function test_01_String_startsWith(t) {
        t.plan(3);
        
        var str = "chickenHead";
        
        var test1 = "chicken";
        var test2 = "beet";

        t.ok(OpenLayers.String.startsWith(str, "chicken"),
             "'chickenHead' starts with 'chicken'");
        t.ok(!OpenLayers.String.startsWith(str, "Head"),
             "'chickenHead' does not start with 'Head'");
        t.ok(!OpenLayers.String.startsWith(str, "beet"),
             "'chickenHead' doesnt start with 'beet'");
    }
    
    function test_02_String_contains(t) {
        t.plan(4);
        
        var str = "chickenHead";

        t.ok(OpenLayers.String.contains(str, "chicken"),
             "(beginning) 'chickenHead' contains with 'chicken'");
        t.ok(OpenLayers.String.contains(str, "ick"),
             "(middle) 'chickenHead' contains with 'ick'");
        t.ok(OpenLayers.String.contains(str, "Head"),
             "(end) 'chickenHead' contains with 'Head'");
        t.ok(!OpenLayers.String.startsWith(str, "beet"),
             "'chickenHead' doesnt start with 'beet'");
    }
    
    function test_03_String_trim(t) {
        t.plan(5);
        
        var str = "chickenHead";
        t.eq(OpenLayers.String.trim(str),
             "chickenHead", "string with no extra whitespace is left alone");

        str = "  chickenHead";
        t.eq(OpenLayers.String.trim(str),
             "chickenHead", "string with extra whitespace at beginning is trimmed correctly");

        str = "chickenHead    ";
        t.eq(OpenLayers.String.trim(str),
             "chickenHead", "string with extra whitespace at end is trimmed correctly");

        str = "  chickenHead    ";
        t.eq(OpenLayers.String.trim(str),
             "chickenHead", "string with extra whitespace at beginning and end is trimmed correctly");

        str = " ";
        t.eq(OpenLayers.String.trim(str), "", "whitespace string is trimmed correctly");
    }
        
    function test_05_String_camelize(t) {
        t.plan(7);
        
        var str = "chickenhead";
        t.eq(OpenLayers.String.camelize(str), "chickenhead", "string with no hyphens is left alone");

        str = "chicken-head";
        t.eq(OpenLayers.String.camelize(str), "chickenHead", "string with one middle hyphen is camelized correctly");

        str = "chicken-head-man";
        t.eq(OpenLayers.String.camelize(str), "chickenHeadMan", "string with multiple middle hyphens is camelized correctly");

        str = "-chickenhead";
        t.eq(OpenLayers.String.camelize(str), "Chickenhead", "string with starting hyphen is camelized correctly (capitalized)");

        str = "-chicken-head-man";
        t.eq(OpenLayers.String.camelize(str), "ChickenHeadMan", "string with starting hypen and multiple middle hyphens is camelized correctly");

        str = "chicken-";
        t.eq(OpenLayers.String.camelize(str), "chicken", "string ending in hyphen is camelized correctly (hyphen dropped)");

        str = "chicken-head-man-";
        t.eq(OpenLayers.String.camelize(str), "chickenHeadMan", "string with multiple middle hyphens and end hyphen is camelized correctly (end hyphen dropped)");


    }
    
    function test_String_format(t) {
        var unchanged = [
            "", "${ ", "${", " ${", "${${", "${}", "${${}}", " ${ ${",
            "}", "${${} }"
        ]
        t.plan(4 + unchanged.length);

        var format = OpenLayers.String.format;
        
        var expected;
        for(var i=0; i<unchanged.length; ++i) {
            expected = unchanged[i];
            t.eq(format(expected), expected,
                 "'" + expected + "' left unchanged");
        }

        t.eq(format("${foo} none"),
             "undefined none", "undefined properties don't bomb");

        window.foo = "bar";
        t.eq(format("${foo} none"),
             "bar none", "window context used if none passed");
        
        var context = {bar: "foo"};
        t.eq(format("${bar} foo", context), "foo foo",
             "properties accessed from context");
        
        var context = {bar: "foo", foo: "bar"};
        t.eq(format("a ${bar} is a ${foo}", context), "a foo is a bar",
             "multiple properties replaced correctly");

    }
   
   
    function test_06_Number_limitSigDigs(t) {
        t.plan(9);
      
        var num = 123456789; 
        t.eq(OpenLayers.Number.limitSigDigs(num), 0, "passing 'null' as sig returns 0");
        t.eq(OpenLayers.Number.limitSigDigs(num, -1), 0, "passing -1 as sig returns 0");
        t.eq(OpenLayers.Number.limitSigDigs(num, 0), 0, "passing 0 as sig returns 0");
        
        t.eq(OpenLayers.Number.limitSigDigs(num, 15), 123456789, "passing sig greater than num digits in number returns number unmodified");
        
        t.eq(OpenLayers.Number.limitSigDigs(num, 1), 100000000, "passing sig 1 works");
        t.eq(OpenLayers.Number.limitSigDigs(num, 3), 123000000, "passing middle sig works (rounds down)");
        t.eq(OpenLayers.Number.limitSigDigs(num, 5), 123460000, "passing middle sig works (rounds up)");
        t.eq(OpenLayers.Number.limitSigDigs(num, 9), 123456789, "passing sig equal to num digits in number works");

        num = 1234.56789;
        t.eq(OpenLayers.Number.limitSigDigs(num, 5), 1234.6, "running limSigDig() on a floating point number works fine");
        
    }

    function test_07_Function_bind(t) {
        t.plan(12);

        g_obj = {};
        g_Arg1 = {};
        g_Arg2 = {};
        g_Arg3 = {};
        g_Arg4 = {};
        var foo = function(x,y,z,a) {
            t.ok(this == g_obj, "context correctly set");
            t.ok(x == g_Arg1, "arg1 passed correctly");    
            t.ok(y == g_Arg2, "arg2 passed correctly");    
            t.ok(z == g_Arg3, "arg3 passed correctly");    
            t.ok(a == g_Arg4, "arg4 passed correctly");    
            t.eq(arguments.length, 4, "correct number of arguments ((regression test for #876))");
        };

        var newFoo = OpenLayers.Function.bind(foo, g_obj, g_Arg1, g_Arg2);

        newFoo(g_Arg3, g_Arg4);
        
        //run again to make sure the arguments are handled correctly
        newFoo(g_Arg3, g_Arg4);
    }

    function test_08_Function_bindAsEventListener(t) {
        t.plan(4);

        g_obj = {};
        g_Event = {};
        g_WindowEvent = {};

        var foo = function(x) {
            t.ok(this == g_obj, "context correctly set");
            g_X = x;
        };

        var newFoo = OpenLayers.Function.bindAsEventListener(foo, g_obj);
        

        g_X = null;
        newFoo(g_Event);
        t.ok(g_X == g_Event, "event properly passed as first argument when event specified");
    
        g_X = null;
        newFoo();
        t.ok(g_X == window.event, "window.event properly passed as first argument when nothing specified");
    }

    function test_Array_filter(t) {
        
        t.plan(8);

        OpenLayers.Array.filter(["foo"], function(item, index, array) {
            t.eq(item, "foo", "callback called with proper item");
            t.eq(index, 0, "callback called with proper index");
            t.eq(array, ["foo"], "callback called with proper array");
            t.eq(this, {"foo": "bar"}, "callback called with this set properly");
        }, {"foo": "bar"});

        var array = [0, 1, 2, 3];
        var select = OpenLayers.Array.filter(array, function(value) {
            return value > 1;
        });
        t.eq(select, [2, 3], "filter works for basic callback");
        t.eq(array, [0, 1, 2, 3], "filter doesn't modify original");
        
        var obj = {
            test: function(value) {
                if(value > 1) {
                    return true;
                }
            }
        };
        var select = OpenLayers.Array.filter(array, function(value) {
            return this.test(value);
        }, obj);
        t.eq(select, [2, 3], "filter works for callback and caller");
        t.eq(array, [0, 1, 2, 3], "filter doesn't modify original");
        
        
    }

        

  </script>
</head>
<body>
</body>
</html>
